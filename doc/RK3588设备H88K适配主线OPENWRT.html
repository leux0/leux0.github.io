<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leux.net","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/config.min.js"></script>



<link rel="canonical" href="https://leux.net/doc/RK3588%E8%AE%BE%E5%A4%87H88K%E9%80%82%E9%85%8D%E4%B8%BB%E7%BA%BFOPENWRT.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://leux.net/doc/RK3588%E8%AE%BE%E5%A4%87H88K%E9%80%82%E9%85%8D%E4%B8%BB%E7%BA%BFOPENWRT.html","path":"doc/RK3588设备H88K适配主线OPENWRT.html","title":"RK3588设备H88K适配主线OPENWRT"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RK3588设备H88K适配主线OPENWRT | 云端笔记</title>
  

  <script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/third-party/analytics/baidu-analytics.min.js"></script>
  <script async src="https://hm.baidu.com/hm.js?48ca531a11053ad348525e965c3ca451"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">云端笔记</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学习的备忘录</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">109</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">7</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">21</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81"><span class="nav-number">1.</span> <span class="nav-text">获取官方源码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E9%80%82%E9%85%8D%E8%AE%BE%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">开始适配设备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E5%88%B6%E4%BD%9C%E8%A1%A5%E4%B8%81"><span class="nav-number">3.</span> <span class="nav-text">手动制作补丁</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-number">4.</span> <span class="nav-text">适配问题解决</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">leux</p>
  <div class="site-description" itemprop="description">好记性不如烂笔头</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">109</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leux.net/doc/RK3588%E8%AE%BE%E5%A4%87H88K%E9%80%82%E9%85%8D%E4%B8%BB%E7%BA%BFOPENWRT.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="leux">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="云端笔记">
      <meta itemprop="description" content="好记性不如烂笔头">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RK3588设备H88K适配主线OPENWRT | 云端笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RK3588设备H88K适配主线OPENWRT
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-20 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-20T00:00:00+00:00">2025-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>&nbsp;<span id="more"></span></p>
<h1 id="获取官方源码"><a href="#获取官方源码" class="headerlink" title="获取官方源码"></a>获取官方源码</h1><ul>
<li>硬件环境及参考提交：<a target="_blank" rel="noopener" href="https://www.hinlink.cn/90.html">HinLink H88Kv3</a> | <a target="_blank" rel="noopener" href="https://github.com/immortalwrt/immortalwrt/commit/0b626299f9f03c9e0e32f7e1452eda71c563df0f">add Cyber 3588 AIB support</a> | <a target="_blank" rel="noopener" href="https://github.com/openwrt/openwrt/commit/76a75b43ba1bf0bdfd5c27b5685e641f9131b6f8">add ArmSoM Sige7 support</a> | <a target="_blank" rel="noopener" href="https://github.com/openwrt/openwrt/commit/9482341a475245cc38244cf5fbe06ca30432315f">add support for nanopc t6</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载源码（--single-branch 仅下载单个分支/标签、--depth=1 只下载最新的一次提交、-b 指定分支/标签）</span></span><br><span class="line">git <span class="built_in">clone</span> --depth=1 -b v24.10.1 https://github.com/openwrt/openwrt</span><br><span class="line"><span class="built_in">cd</span> openwrt/</span><br><span class="line">git pull</span><br><span class="line">./scripts/feeds update -a</span><br><span class="line">./scripts/feeds install -a</span><br><span class="line"></span><br><span class="line">make menuconfig				<span class="comment"># 进入固件配置界面增减改查</span></span><br><span class="line">make download V=s -j$(<span class="built_in">nproc</span>)		<span class="comment"># 请尽量用梯子下载所需源码</span></span><br><span class="line">make V=s -j$(<span class="built_in">nproc</span>)			<span class="comment"># 若编译出错请用单线程调错</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左边的包依赖右边的包，所以只需要选择左边的包即可包含右边的依赖包</span></span><br><span class="line"><span class="comment"># luci-proto-mbim -&gt; umbim -&gt; kmod-usb-net-cdc-mbim -&gt; kmod-usb-net</span></span><br><span class="line"><span class="comment"># luci-proto-ncm  -&gt; comgt-ncm -&gt; kmod-usb-net-huawei-cdc-ncm -&gt; kmod-usb-net-cdc-ncm -&gt; kmod-usb-serial-option</span></span><br><span class="line"><span class="comment"># kmod-mt7916-firmware -&gt; kmod-mt7915e -&gt; kmod-mac80211 - kmod-mt76-connac - kmod-hwmon-core - kmod-thermal</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如下相关软件包只能同时选择一个，共存会在安装时报错</span></span><br><span class="line"><span class="comment"># &gt; Base system &gt; dnsmasq</span></span><br><span class="line"><span class="comment"># &gt; Base system &gt; dnsmasq-full</span></span><br><span class="line"><span class="comment"># &gt; Libraries &gt; libustream-openssl	# &gt; Libraries &gt; SSL &gt; libopenssl</span></span><br><span class="line"><span class="comment"># &gt; Libraries &gt; libustream-mbedtls	# &gt; Libraries &gt; SSL &gt; libmbedtls</span></span><br><span class="line"><span class="comment"># &gt; Libraries &gt; libustream-wolfssl	# &gt; Libraries &gt; SSL &gt; libwolfssl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他相关包的介绍</span></span><br><span class="line"><span class="comment"># &gt; LuCI &gt; 1. Collections &gt; luci-ssl-openssl				# 页面支持HTTPS访问</span></span><br><span class="line"><span class="comment"># &gt; LuCI &gt; 2. Modules &gt; luci-compat					# 页面最下会显示【Lua 兼容模式激活】</span></span><br><span class="line"><span class="comment"># &gt; LuCI &gt; 2. Modules &gt; Translations -&gt; Chinese Simplified (zh_Hans)	# 默认使用中文，配置为：CONFIG_LUCI_LANG_zh_Hans=y</span></span><br><span class="line"><span class="comment"># &gt; LuCI &gt; 5. Protocols &gt; luci-proto-modemmanager			# 首页中多出【蜂窝网络】页面</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="开始适配设备"><a href="#开始适配设备" class="headerlink" title="开始适配设备"></a>开始适配设备</h1><ol>
<li>修改 <code>target/linux/rockchip/image/armv8.mk</code> 添加如下内容，使其出现在 <code>make menuconfig</code> 里面</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># target/linux/rockchip/image/armv8.mk</span><br><span class="line"></span><br><span class="line">define Device/hinlink_h88k</span><br><span class="line">  DEVICE_VENDOR := HINLINK</span><br><span class="line">  DEVICE_MODEL := H88K</span><br><span class="line">  SOC := rk3588</span><br><span class="line">  DEVICE_DTS := rockchip/rk3588-h88k</span><br><span class="line">  UBOOT_DEVICE_NAME := h88k-rk3588</span><br><span class="line">  BOOT_FLOW := pine64-img</span><br><span class="line">  DEVICE_PACKAGES := wpad-openssl kmod-mt7916-firmware kmod-r8125 kmod-r8169 kmod-nvme \</span><br><span class="line">    usbutils pciutils luci luci-ssl-openssl luci-proto-ncm luci-proto-mbim</span><br><span class="line">endef</span><br><span class="line">TARGET_DEVICES += hinlink_h88k</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加适配设备名到指定文件使其可初始化网络和优化网络设备性能</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 将如下带 + 的行添加到：target/linux/rockchip/armv8/base-files/etc/board.d/02_network</span><br><span class="line"></span><br><span class="line">rockchip_setup_interfaces()</span><br><span class="line">&#123;</span><br><span class="line">	local board=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">	case &quot;$board&quot; in</span><br><span class="line"><span class="addition">+	hinlink,h88k|\</span></span><br><span class="line">	armsom,sige7|\</span><br><span class="line">......</span><br><span class="line">rockchip_setup_macs()</span><br><span class="line">&#123;</span><br><span class="line">	local board=&quot;$1&quot;</span><br><span class="line">	local lan_mac=&quot;&quot;</span><br><span class="line">	local wan_mac=&quot;&quot;</span><br><span class="line">	local label_mac=&quot;&quot;</span><br><span class="line"></span><br><span class="line">	case &quot;$board&quot; in</span><br><span class="line"><span class="addition">+	hinlink,h88k|\</span></span><br><span class="line">	armsom,sige7|\</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------------------------------------------------------------------------------------</span></span><br><span class="line"># 将如下带 + 的行添加到：target/linux/rockchip/armv8/base-files/etc/hotplug.d/net/40-net-smp-affinity</span><br><span class="line"></span><br><span class="line">  case &quot;$(board_name)&quot; in</span><br><span class="line"><span class="addition">+ hinlink,h88k|\</span></span><br><span class="line">  armsom,sige7|\</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在内核源码中为需要适配的设备添加设备树，也可选用后续的制作内核补丁方法（二选一即可）</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 获取适配设备的DTS并将其放到指定位置，在OPENWRT构建时该文件会复制到内核源码中</span><br><span class="line">mkdir -p ~/openwrt/target/linux/rockchip/files/arch/arm64/boot/dts/rockchip/</span><br><span class="line">wget https://github.com/DHDAXCW/lede-rockchip/raw/stable/target/linux/rockchip/files/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts \</span><br><span class="line"><span class="deletion">-O ~/openwrt/target/linux/rockchip/files/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts</span></span><br><span class="line"></span><br><span class="line"># 有了DTS还需要在Makefile中添加，将如下补丁添加到这个位置，让构建OPENWRT时应用补丁到内核源码中</span><br><span class="line"><span class="comment">---- target/linux/rockchip/patches-6.6/500-arm64-dts-rockchip-Add-Hinlink-H88k.patch ----</span></span><br><span class="line">diff -Nur a/arch/arm64/boot/dts/rockchip/Makefile b/arch/arm64/boot/dts/rockchip/Makefile</span><br><span class="line"><span class="comment">--- a/arch/arm64/boot/dts/rockchip/Makefile</span></span><br><span class="line"><span class="comment">+++ b/arch/arm64/boot/dts/rockchip/Makefile</span></span><br><span class="line"><span class="meta">@@ -114,3 +114,4 @@</span></span><br><span class="line"> dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3588s-nanopi-r6s.dtb</span><br><span class="line"> dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3588s-nanopi-r6c.dtb</span><br><span class="line"> dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3588s-rock-5a.dtb</span><br><span class="line"><span class="addition">+dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3588-h88k.dtb</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 U-Boot 中添加本适配的设备，也可选用后续的制作 U-Boot 补丁方法（二选一即可）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先在 package/boot/uboot-rockchip/Makefile 中添加本适配设备</span></span><br><span class="line"></span><br><span class="line">define U-Boot/h88k-rk3588</span><br><span class="line">  $(U-Boot/rk3588/Default)</span><br><span class="line">  NAME:=HINLINK H88K</span><br><span class="line">  BUILD_DEVICES:= \</span><br><span class="line">    hinlink_h88k</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">UBOOT_TARGETS := \</span><br><span class="line">  h88k-rk3588 \</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我这里使用官方支持的相近配置的设备 Armsom-Sige7 的设备树及配置</span></span><br><span class="line"><span class="built_in">mkdir</span> -p  ~/openwrt/package/boot/uboot-rockchip/src/arch/arm/dts/</span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/package/boot/uboot-rockchip/src/arch/arm/dts/</span><br><span class="line">wget -O rk3588-h88k-u-boot.dtsi https://source.denx.de/u-boot/u-boot/-/raw/v2024.10/arch/arm/dts/rk3588-armsom-sige7-u-boot.dtsi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个设备树文件所在路径与配置文件中的 CONFIG_DEFAULT_DEVICE_TREE 有关</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/package/boot/uboot-rockchip/src/dts/upstream/src/arm64/rockchip/</span><br><span class="line">wget -O rk3588-h88k.dts https://source.denx.de/u-boot/u-boot/-/raw/v2024.10/dts/upstream/src/arm64/rockchip/rk3588-armsom-sige7.dts</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/openwrt/package/boot/uboot-rockchip/src/configs/</span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/package/boot/uboot-rockchip/src/configs/</span><br><span class="line">wget -O h88k-rk3588_defconfig https://source.denx.de/u-boot/u-boot/-/raw/v2024.10/configs/sige7-rk3588_defconfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将获取到的 Armsom-Sige7 配置及设备树修改下，不修改也能直接用，但在U-Boot中会显示为：Model: ArmSoM Sige7  ，但也不碍事</span></span><br><span class="line">vi ~/openwrt/package/boot/uboot-rockchip/src/configs/h88k-rk3588_defconfig</span><br><span class="line"><span class="comment"># CONFIG_DEFAULT_DEVICE_TREE=&quot;rockchip/rk3588-armsom-sige7&quot;	替换为	CONFIG_DEFAULT_DEVICE_TREE=&quot;rockchip/rk3588-h88k&quot;</span></span><br><span class="line"><span class="comment"># CONFIG_DEFAULT_FDT_FILE=&quot;rockchip/rk3588-armsom-sige7.dtb&quot;	替换为	CONFIG_DEFAULT_FDT_FILE=&quot;rockchip/rk3588-h88k.dtb&quot;</span></span><br><span class="line"></span><br><span class="line">vi ~/openwrt/package/boot/uboot-rockchip/src/arch/arm/dts/rk3588-h88k.dts</span><br><span class="line"><span class="comment"># model = &quot;ArmSoM Sige7&quot;;					替换为	model = &quot;HINLINK H88K&quot;;</span></span><br><span class="line"><span class="comment"># compatible = &quot;armsom,sige7&quot;, &quot;rockchip,rk3588&quot;;		替换为	compatible = &quot;hinlink,h88k&quot;, &quot;rockchip,rk3588&quot;;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="手动制作补丁"><a href="#手动制作补丁" class="headerlink" title="手动制作补丁"></a>手动制作补丁</h1><ol>
<li>根据如下教程为内核制作补丁</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先为 Armsom-Sige7 编译一次 OPENWRT，完成后用如下命令清空内核源码目录，然后重新解压内核源码并应用自带的补丁</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/</span><br><span class="line">make target/linux/clean V=s					<span class="comment"># 清空源码目录</span></span><br><span class="line">make target/linux/prepare V=s					<span class="comment"># 解压及打补丁</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取适配设备的内核设备树及添加新增的设备到 Makefile</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/build_dir/target-aarch64_generic_musl/linux-rockchip_armv8/</span><br><span class="line"></span><br><span class="line">wget https://github.com/DHDAXCW/lede-rockchip/raw/stable/target/linux/rockchip/files/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts \</span><br><span class="line">-O linux-6.6.86/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> linux-6.6.86/arch/arm64/boot/dts/rockchip/Makefile linux-6.6.86/arch/arm64/boot/dts/rockchip/Makefile.bak</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;dtb-\$(CONFIG_ARCH_ROCKCHIP) += rk3588-h88k.dtb&quot;</span> &gt;&gt; linux-6.6.86/arch/arm64/boot/dts/rockchip/Makefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后将上面新增的设备树相关制作成补丁放到 target/linux/rockchip/patches-6.6/ 中即可在构建 OPENWRT 时自动应用补丁</span></span><br><span class="line">diff -Nur linux-6.6.86/arch/arm64/boot/dts/rockchip/Makefile.bak linux-6.6.86/arch/arm64/boot/dts/rockchip/Makefile &gt;&gt; 500-arm64-dts-rockchip-rk3588-Add-Hinlink-H88k.patch</span><br><span class="line">diff -Nur /dev/null linux-6.6.86/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts &gt;&gt; 500-arm64-dts-rockchip-rk3588-Add-Hinlink-H88k.patch</span><br><span class="line"><span class="built_in">mv</span> ./500-arm64-dts-rockchip-rk3588-Add-Hinlink-H88k.patch ~/openwrt/target/linux/rockchip/patches-6.6/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后可以重新清空源码目录，解压打补丁，再编译看看会不会报错，如果没有问题那么内核的补丁就做好了</span></span><br><span class="line">make target/linux/clean V=s					<span class="comment"># 清空内核源码</span></span><br><span class="line">make target/linux/prepare V=s					<span class="comment"># 解包及打补丁</span></span><br><span class="line">make target/linux/compile V=s					<span class="comment"># 编译内核源码</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 U-Boot 中添加本适配的设备，我这照抄官方支持的设备 Armsom-Sige7 的配置小改并做成补丁</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 依旧先在 package/boot/uboot-rockchip/Makefile 中添加本适配设备</span></span><br><span class="line"></span><br><span class="line">define U-Boot/h88k-rk3588</span><br><span class="line">  $(U-Boot/rk3588/Default)</span><br><span class="line">  NAME:=HINLINK H88K</span><br><span class="line">  BUILD_DEVICES:= \</span><br><span class="line">    hinlink_h88k</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">UBOOT_TARGETS := \</span><br><span class="line">  h88k-rk3588 \</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先为 Armsom-Sige7 编译一次 OPENWRT，完成后用如下命令清空 U-Boot 的源码目录，然后重新解压 U-Boot 的源码并应用自带的补丁</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/</span><br><span class="line">make package/boot/uboot-rockchip/clean V=s			<span class="comment"># 清空源码目录</span></span><br><span class="line">make package/boot/uboot-rockchip/prepare V=s			<span class="comment"># 解压及打补丁</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 Armsom-Sige7 的 U-Boot 设备树待用</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/build_dir/target-aarch64_generic_musl/u-boot-sige7-rk3588/u-boot-2024.10/arch/arm/dts/</span><br><span class="line"><span class="built_in">cp</span> rk3588-armsom-sige7-u-boot.dtsi rk3588-h88k-u-boot.dtsi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 Armsom-Sige7 的配置并小改</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/build_dir/target-aarch64_generic_musl/u-boot-sige7-rk3588/u-boot-2024.10/configs/</span><br><span class="line"><span class="built_in">cp</span> sige7-rk3588_defconfig h88k-rk3588_defconfig</span><br><span class="line"><span class="comment"># CONFIG_DEFAULT_DEVICE_TREE=&quot;rockchip/rk3588-armsom-sige7&quot;	替换为	CONFIG_DEFAULT_DEVICE_TREE=&quot;rockchip/rk3588-h88k&quot;</span></span><br><span class="line"><span class="comment"># CONFIG_DEFAULT_FDT_FILE=&quot;rockchip/rk3588-armsom-sige7.dtb&quot;	替换为	CONFIG_DEFAULT_FDT_FILE=&quot;rockchip/rk3588-h88k.dtb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 Armsom-Sige7 的设备树并小改</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/build_dir/target-aarch64_generic_musl/u-boot-sige7-rk3588/u-boot-2024.10/dts/upstream/src/arm64/rockchip/</span><br><span class="line"><span class="built_in">cp</span> rk3588-armsom-sige7.dts rk3588-h88k.dts</span><br><span class="line"><span class="comment"># model = &quot;ArmSoM Sige7&quot;;					替换为	model = &quot;HINLINK H88K&quot;;</span></span><br><span class="line"><span class="comment"># compatible = &quot;armsom,sige7&quot;, &quot;rockchip,rk3588&quot;;		替换为	compatible = &quot;hinlink,h88k&quot;, &quot;rockchip,rk3588&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后将上面新增的DTS和配置制作成补丁放到 package/boot/uboot-rockchip/patches/ 中即可在构建 OPENWRT 时自动应用补丁</span></span><br><span class="line"><span class="built_in">cd</span> ~/openwrt/build_dir/target-aarch64_generic_musl/u-boot-sige7-rk3588/</span><br><span class="line">diff -Nur /dev/null u-boot-2024.10/configs/h88k-rk3588_defconfig &gt;&gt; 110-rockchip-add-Hinlink-H88k.patch</span><br><span class="line">diff -Nur /dev/null u-boot-2024.10/arch/arm/dts/rk3588-h88k-u-boot.dtsi &gt;&gt; 110-rockchip-add-Hinlink-H88k.patch</span><br><span class="line">diff -Nur /dev/null u-boot-2024.10/dts/upstream/src/arm64/rockchip/rk3588-h88k.dts &gt;&gt; 110-rockchip-add-Hinlink-H88k.patch</span><br><span class="line"><span class="built_in">mv</span> ./110-rockchip-add-Hinlink-H88k.patch ~/openwrt/package/boot/uboot-rockchip/patches/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后可以重新清空源码目录，解压打补丁，再编译看看会不会报错，如果没有问题那么 U-Boot 的补丁就做好了</span></span><br><span class="line">make package/boot/uboot-rockchip/clean V=s			<span class="comment"># 清空源码目录</span></span><br><span class="line">make package/boot/uboot-rockchip/prepare V=s			<span class="comment"># 解压及打补丁</span></span><br><span class="line">make package/boot/uboot-rockchip/compile V=s			<span class="comment"># 编译程序源码</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="适配问题解决"><a href="#适配问题解决" class="headerlink" title="适配问题解决"></a>适配问题解决</h1><ol>
<li>内核编译时设备树出错</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 由于新增的dts中有没有定义的节点遂出错，删除它即可</span><br><span class="line">  OBJCOPY arch/arm64/boot/Image</span><br><span class="line">  DTC     arch/arm64/boot/dts/rockchip/rk3588-h88k.dtb</span><br><span class="line">Error: arch/arm64/boot/dts/rockchip/rk3588-h88k.dts:1001.1-5 Label or path rng not found</span><br><span class="line">FATAL ERROR: Syntax error parsing input tree</span><br><span class="line"></span><br><span class="line"># https://github.com/DHDAXCW/lede-rockchip/raw/stable/target/linux/rockchip/files/arch/arm64/boot/dts/rockchip/rk3588-h88k.dts</span><br><span class="line"># 删除 arch/arm64/boot/dts/rockchip/rk3588-h88k.dts 第 1001 行的如下节点即可</span><br><span class="line">&amp;rng &#123;</span><br><span class="line">	status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line"># 也可添加如下补丁到 target/linux/rockchip/patches-6.6/801-05-arm64-dts-rockchip-rk3588s-add-rng-node.patch</span><br><span class="line"><span class="comment">--- a/arch/arm64/boot/dts/rockchip/rk3588-base.dtsi</span></span><br><span class="line"><span class="comment">+++ b/arch/arm64/boot/dts/rockchip/rk3588-base.dtsi</span></span><br><span class="line"><span class="meta">@@ -1770,6 +1770,17 @@</span></span><br><span class="line"> 		status = &quot;disabled&quot;;</span><br><span class="line"> 	&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="addition">+	rng: rng@fe378000 &#123;</span></span><br><span class="line"><span class="addition">+		compatible = &quot;rockchip,trngv1&quot;;</span></span><br><span class="line"><span class="addition">+		reg = &lt;0x0 0xfe378000 0x0 0x200&gt;;</span></span><br><span class="line"><span class="addition">+		interrupts = &lt;GIC_SPI 400 IRQ_TYPE_LEVEL_HIGH&gt;;</span></span><br><span class="line"><span class="addition">+		clocks = &lt;&amp;scmi_clk SCMI_HCLK_SECURE_NS&gt;;</span></span><br><span class="line"><span class="addition">+		clock-names = &quot;hclk_trng&quot;;</span></span><br><span class="line"><span class="addition">+		resets = &lt;&amp;scmi_reset SRST_H_TRNG_NS&gt;;</span></span><br><span class="line"><span class="addition">+		reset-names = &quot;reset&quot;;</span></span><br><span class="line"><span class="addition">+		status = &quot;disabled&quot;;</span></span><br><span class="line"><span class="addition">+	&#125;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> 	i2s0_8ch: i2s@fe470000 &#123;</span><br><span class="line"> 		compatible = &quot;rockchip,rk3588-i2s-tdm&quot;;</span><br><span class="line"> 		reg = &lt;0x0 0xfe470000 0x0 0x1000&gt;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编译 U-Boot 时的问题</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">make[6]: *** No rule to make target &#x27;dts/upstream/src/arm64/rockchip/rk3588-h88k.dtb&#x27;, needed by &#x27;dtbs&#x27;.  Stop.</span><br><span class="line"></span><br><span class="line"># u-boot-h88k-rk3588/u-boot-2024.10/dts/upstream/src/arm64/rockchip/rk3588-h88k.dts 也要存在</span><br><span class="line"># 不能用rk3588-evb1-v10.dts，因为其dts中没有SD卡从而导致后期无法启动，可试rk3588-armsom-sige7.dts</span><br><span class="line"></span><br><span class="line"># 配置中 CONFIG_TARGET_XXX_RK3588 在 u-boot-2024.10/arch/arm/mach-rockchip/rk3588/Kconfig 中定义，所以为了省事直接用 sige7 的吧</span><br><span class="line"></span><br><span class="line"># OPENWRT中U-Boot的版本定义在 ~/openwrt/package/boot/uboot-rockchip/Makefile 中的 PKG_VERSION:=2024.10</span><br><span class="line"># OPENWRT中U-Boot的源码下载地址定义在 ~/openwrt/include/u-boot.mk 中，最后组合为：https://ftp.denx.de/pub/u-boot/u-boot-2024.10.tar.bz2</span><br><span class="line">ifndef PKG_SOURCE_PROTO</span><br><span class="line">PKG_SOURCE = $(PKG_NAME)-$(PKG_VERSION).tar.bz2</span><br><span class="line">PKG_SOURCE_URL = \</span><br><span class="line">	https://mirror.cyberbits.eu/u-boot \</span><br><span class="line">	https://ftp.denx.de/pub/u-boot \</span><br><span class="line">	ftp://ftp.denx.de/pub/u-boot</span><br><span class="line">endif</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过串口调试进入U-Boot后通过命令手动引导OPENWRT系统</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------------------</span><br><span class="line">U-Boot 2024.10-OpenWrt-r0-9e9f687 (Apr 14 2025 - 17:32:05 +0000)</span><br><span class="line"></span><br><span class="line">Model: HINLINK H88K</span><br><span class="line">DRAM:  16 GiB</span><br><span class="line">Core:  327 devices, 23 uclasses, devicetree: separate</span><br><span class="line">MMC:   mmc@fe2c0000: 0, mmc@fe2e0000: 1</span><br><span class="line">Loading Environment from nowhere... OK</span><br><span class="line">In:    serial@feb50000</span><br><span class="line">Out:   serial@feb50000</span><br><span class="line">Err:   serial@feb50000</span><br><span class="line">Model: HINLINK H88K</span><br><span class="line">Net:   No ethernet found.</span><br><span class="line">Hit any key to stop autoboot:  0</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">=&gt; printenv</span><br><span class="line">kernel_addr_r=0x02000000</span><br><span class="line">ramdisk_addr_r=0x12180000</span><br><span class="line">fdt_addr_r=0x12000000</span><br><span class="line">fdtfile=rockchip/rk3588-h88k.dtb</span><br><span class="line">boot_targets=mmc1 mmc0 nvme scsi usb pxe dhcp spi</span><br><span class="line">uuid=B921B045-1DF0-41C3-AF44-4C6F280D3FAE</span><br><span class="line">stdout=serial@feb50000</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"># 文件 ~/openwrt/target/linux/rockchip/image/default.bootscript 最终会被 mkimage 制作成 boot.scr</span><br><span class="line">=&gt; setenv bootargs &quot;console=ttyS2,1500000 earlycon=uart8250,mmio32,0xfeb50000 root=/dev/mmcblk0p2 rw rootwait&quot;</span><br><span class="line">=&gt; load mmc 1 0x02000000 kernel.img</span><br><span class="line">=&gt; bootm 0x02000000</span><br><span class="line"></span><br><span class="line"># 关于板载eMMC和外置SD卡在U-Boot中的序号定义，Sige7中默认 mmc0 是板载eMMC，mmc1 是SD卡。骷髅头的则相反</span><br><span class="line">u-boot-2024.10/dts/upstream/src/arm64/rockchip/rk3588-armsom-sige7.dts</span><br><span class="line">		mmc0 = &amp;sdhci;</span><br><span class="line">		mmc1 = &amp;sdmmc;</span><br><span class="line"></span><br><span class="line"># 但因为我这里仅用了骷髅头的内核设备树，所以进了内核 /dev/mmcblk0p2 才是SD卡中的OPENWRT，而U-Boot中mmc0依然是板载eMMC</span><br><span class="line">https://github.com/DHDAXCW/lede-rockchip/blob/stable/package/boot/uboot-rockchip/src/arch/arm/dts/rk3588-h88k.dts</span><br><span class="line">		mmc0 = &amp;sdmmc;</span><br><span class="line">		mmc1 = &amp;sdhci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>OpenWrt系统网络配置的生成和其他系统设置的修改</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果LAN下接入设备的DNS有问题，请在 网络 -&gt; 接口 -&gt; LAN -&gt; 高级设置 -&gt; 使用自定义的 DNS 服务器 -&gt; 添加其他DNS服务器</span></span><br><span class="line">/etc/inittab -&gt; /etc/init.d/boot -&gt; (/bin/config_generate &amp;&amp; /sbin/wifi config)</span><br><span class="line">/bin/config_generate	/etc/board.json		侦测生成 model network	/etc/config/system /etc/config/network</span><br><span class="line">/sbin/wifi config	/etc/board.json		侦测生成 wlan		/etc/config/wireless	可将 option disabled <span class="string">&#x27;1&#x27;</span> 设置为 <span class="string">&#x27;0&#x27;</span> 启用WiFi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 ~/openwrt/package/base-files/files/bin/config_generate 中第 165 行如下可设置默认局域网IP地址</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">	lan) ipad=<span class="variable">$&#123;ipaddr:-&quot;192.168.1.1&quot;&#125;</span> ;;</span><br><span class="line">	*) ipad=<span class="variable">$&#123;ipaddr:-&quot;192.168.$((addr_offset++)).1&quot;&#125;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 ~/openwrt/package/base-files/files/bin/config_generate 文件中第 314 行如下可设置默认主机名，时区等</span></span><br><span class="line"><span class="built_in">set</span> system.@system[-1].hostname=<span class="string">&#x27;OpenWrt&#x27;</span>		<span class="comment"># 要显示的主机名</span></span><br><span class="line"><span class="built_in">set</span> system.@system[-1].timezone=<span class="string">&#x27;CST-8&#x27;</span>			<span class="comment"># 修改时区为 CST-8</span></span><br><span class="line"><span class="built_in">set</span> system.@system[-1].zonename=<span class="string">&#x27;Asia/Shanghai&#x27;</span>		<span class="comment"># 再在下一行添加如下内容</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>解决 LuCI 版本显示异常问题 <code>(HEAD detached at 2ac26e56)</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenWrt中该问题的讨论：https://github.com/openwrt/luci/pull/7745</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SNAPSHOT 版本和 24.10.1 的版本默认显示对比如下</span></span><br><span class="line">固件版本	OpenWrt 24.10-SNAPSHOT r0-78d517a / LuCI openwrt-24.10 branch 25.115.55128~bedefb1</span><br><span class="line">Powered by LuCI openwrt-24.10 branch (25.115.55128~bedefb1) / OpenWrt 24.10-SNAPSHOT (r0-78d517a) / Lua 兼容模式激活</span><br><span class="line"></span><br><span class="line">固件版本	OpenWrt 24.10.1 r28597-0425664679 / LuCI (HEAD detached at 2ac26e56) branch 25.103.51521~2ac26e5</span><br><span class="line">Powered by LuCI (HEAD detached at 2ac26e56) branch (25.103.51521~2ac26e5) / OpenWrt 24.10.1 (r28597-0425664679)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑 openwrt/feeds/luci/modules/luci-base/Makefile 中第11行后添加：PKG_GITBRANCH:=LuCI openwrt-24.10 branch</span></span><br><span class="line"><span class="comment"># 修复后的显示，往后官方的 24.10.2 因为已经修复就不需要修改了</span></span><br><span class="line">固件版本	OpenWrt 24.10.1 r28597-0425664679 / LuCI openwrt-24.10 branch 25.103.51521~2ac26e5</span><br><span class="line">Powered by LuCI openwrt-24.10 branch (25.103.51521~2ac26e5) / OpenWrt 24.10.1 (r28597-0425664679)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>调整内核后缀与OpenWrt官方源中版本一致来使用官方源中的内核模块</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前运行的OpenWrt内核后缀</span></span><br><span class="line">root@OpenWRT:~# opkg info kernel</span><br><span class="line">Package: kernel</span><br><span class="line">Version: 6.6.86~9c44f65d374062718cc717437267393e-r1</span><br><span class="line">Depends: libc</span><br><span class="line">Status: install ok installed</span><br><span class="line">Architecture: aarch64_generic</span><br><span class="line">Installed-Time: 1744562312</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内核修改前的后缀值</span></span><br><span class="line">leux@Debian:~/openwrt$ <span class="built_in">cat</span> build_dir/target-aarch64_generic_musl/linux-rockchip_armv8/linux-6.6.86/.vermagic</span><br><span class="line">9c44f65d374062718cc717437267393e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先查看要用的OpenWrt源中内核的版本信息</span></span><br><span class="line">leux@Debian:~$ curl -s https://downloads.openwrt.org/releases/24.10.1/targets/rockchip/armv8/openwrt-24.10.1-rockchip-armv8.manifest | grep kernel</span><br><span class="line">kernel - 6.6.86~a8e18e0ecc66cc99303d258424ec0db8-r1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 openwrt/include/kernel-defaults.mk 中第 130 行如下内容注释并在其后添加另一行</span></span><br><span class="line">......</span><br><span class="line">    <span class="comment"># grep &#x27;=[ym]&#x27; $(LINUX_DIR)/.config.set | LC_ALL=C sort | $(MKHASH) md5 &gt; $(LINUX_DIR)/.vermagic</span></span><br><span class="line">    <span class="built_in">cp</span> $(TOPDIR)/.vermagic $(LINUX_DIR)/.vermagic</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源中内核的后缀添加到OpenWrt源码根目录，后续内核编译时会将其拷贝到内核源码根目录并将其内容作为内核后缀</span></span><br><span class="line">leux@Debian:~/openwrt$ <span class="built_in">echo</span> <span class="string">&quot;a8e18e0ecc66cc99303d258424ec0db8&quot;</span> &gt; ~/openwrt/.vermagic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后生成的内核包：bin/targets/rockchip/armv8/packages/kernel_6.6.86~a8e18e0ecc66cc99303d258424ec0db8-r1_aarch64_generic.ipk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷入该系统后可更换默认软件源为国内源，如下首行KMOD源即是上面后缀一致可用的官方内核模块源</span></span><br><span class="line">src/gz openwrt_kmod https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/targets/rockchip/armv8/kmods/6.6.86-1-a8e18e0ecc66cc99303d258424ec0db8</span><br><span class="line">src/gz openwrt_core https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/targets/rockchip/armv8/packages</span><br><span class="line">src/gz openwrt_base https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/packages/aarch64_generic/base</span><br><span class="line">src/gz openwrt_luci https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/packages/aarch64_generic/luci</span><br><span class="line">src/gz openwrt_packages https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/packages/aarch64_generic/packages</span><br><span class="line">src/gz openwrt_routing https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/packages/aarch64_generic/routing</span><br><span class="line">src/gz openwrt_telephony https://mirrors.ustc.edu.cn/openwrt/releases/24.10.1/packages/aarch64_generic/telephony</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>移植 Immortalwrt 中的包 luci-proto-quectel 到OpenWrt</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载后复制如下文件夹中所有的文件到OpenWrt中指定目录下</span></span><br><span class="line">https://github.com/immortalwrt/packages/tree/master/net/quectel-cm/			<span class="comment"># ~/openwrt/feeds/packages/net/quectel-cm/</span></span><br><span class="line">https://github.com/immortalwrt/luci/tree/master/protocols/luci-proto-quectel/		<span class="comment"># ~/openwrt/feeds/luci/protocols/luci-proto-quectel/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改如下文件中的源码下载地址及删除其中的私有依赖项：+kmod-usb-net-qmi-wwan-fibocom +kmod-usb-net-qmi-wwan-quectel</span></span><br><span class="line">~/openwrt/feeds/packages/net/quectel-cm/Makefile</span><br><span class="line">PKG_SOURCE_URL:=https://sources.immortalwrt.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可修改如下文件中第27行 return _(&#x27;Quectel Cellular&#x27;); 这个值将会在接口的协议处显示</span></span><br><span class="line">~/openwrt/feeds/luci/protocols/luci-proto-quectel/htdocs/luci-static/resources/protocol/quectel.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝及修改完成后要执行 ./scripts/feeds update -a 后才能在配置菜单中出现，最后在配置菜单中的位置</span></span><br><span class="line">&gt; Network &gt; WWAN &gt; quectel-cm				<span class="comment"># CONFIG_PACKAGE_quectel-cm=y</span></span><br><span class="line">&gt; LuCI &gt; 5. Protocols &gt; luci-proto-quectel		<span class="comment"># CONFIG_PACKAGE_luci-proto-quectel=y</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>如何手动将内核和根文件系统挪到一个分区</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenWrt官方镜像默认分区情况如下，有两个不连续的空闲空间和两个分区</span></span><br><span class="line">|-- NULL 32M --|-- kernel 16M --|-- NULL 16M --|-- rootfs 104M --|</span><br><span class="line"><span class="comment"># 我想将其改成如下单分区情况，前面16M存放U-Boot后面存放内核及根文件系统</span></span><br><span class="line">|-- NULL 16M --|------------------ rootfs 100% ------------------|</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用parted创建单个分区，如用fdisk可输入起始扇率为 +32768 实现16MB偏移</span></span><br><span class="line"><span class="built_in">sudo</span> parted -s /dev/mmcblk1 mklabel gpt</span><br><span class="line"><span class="built_in">sudo</span> parted -s /dev/mmcblk1 mkpart primary ext4 16MiB 100%</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将OpenWrt中编译完成的U-Boot文件写入磁盘</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">dd</span> <span class="keyword">if</span>=~/openwrt/staging_dir/target-aarch64_generic_musl/image/h88k-rk3588-u-boot-rockchip.bin of=/dev/mmcblk1 seek=64 conv=notrunc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区完成后将OpenWrt官方镜像中的 kernel.img 放到单一根文件系统的 /boot/kernel.img</span></span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 /dev/mmcblk1p1</span><br><span class="line"><span class="built_in">sudo</span> mount /dev/mmcblk1p1 /media/leux/		<span class="comment"># 将OpenWrt官方镜像的根文件系统拷贝到当前分区</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可在U-Boot中手动启动OpenWrt系统，也可根据后面修改 /boot/boot.scr 来自动启动</span></span><br><span class="line">=&gt; setenv bootargs <span class="string">&quot;console=ttyS2,1500000 earlycon=uart8250,mmio32,0xfeb50000 root=/dev/mmcblk0p1 rw rootwait&quot;</span></span><br><span class="line">=&gt; load mmc 1 <span class="variable">$&#123;kernel_addr_r&#125;</span> /boot/kernel.img</span><br><span class="line">=&gt; bootm <span class="variable">$&#123;kernel_addr_r&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝OpenWrt官方源码中的U-Boot启动脚本到指定路径</span></span><br><span class="line"><span class="built_in">cp</span> ~/openwrt/target/linux/rockchip/image/default.bootscript ~/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改U-Boot启动脚本 default.bootscript 中如下两句，即将分区 $&#123;devnum&#125;:2改为1，内核位置 kernel.img 改为 /boot/kernel.img</span></span><br><span class="line">part uuid <span class="variable">$&#123;devtype&#125;</span> <span class="variable">$&#123;devnum&#125;</span>:2 uuid				part uuid <span class="variable">$&#123;devtype&#125;</span> <span class="variable">$&#123;devnum&#125;</span>:1 uuid</span><br><span class="line">load <span class="variable">$&#123;devtype&#125;</span> <span class="variable">$&#123;devnum&#125;</span>:1 <span class="variable">$&#123;kernel_addr_r&#125;</span> kernel.img		load <span class="variable">$&#123;devtype&#125;</span> <span class="variable">$&#123;devnum&#125;</span>:1 <span class="variable">$&#123;kernel_addr_r&#125;</span> /boot/kernel.img</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后将修改后的启动脚本制作成 boot.scr，并将其放到单一根文件系统的 /boot/boot.scr</span></span><br><span class="line">mkimage -A arm -O linux -T script -C none -a 0 -e 0 -d ~/default.bootscript /mnt/d/boot.scr</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/openwrt/" rel="tag"><i class="fa fa-tag"></i> openwrt</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/doc/U-Boot%E6%9E%84%E5%BB%BA%E5%90%AF%E5%8A%A8Linux%E7%B3%BB%E7%BB%9F.html" rel="prev" title="U-Boot构建启动Linux系统">
                  <i class="fa fa-angle-left"></i> U-Boot构建启动Linux系统
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/doc/RK3588%E8%AE%BE%E5%A4%87H88K%E9%80%82%E9%85%8D%E4%B8%BB%E7%BA%BFU-Boot.html" rel="next" title="RK3588设备H88K适配主线U-Boot">
                  RK3588设备H88K适配主线U-Boot <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备2023036155号 </a>
  </div>
  <div class="copyright">
    &copy; 2016 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">leux</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://s4.zstatic.net/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/comments.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/utils.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/sidebar.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/next-boot.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/pjax.min.js"></script>

  <script src="https://s4.zstatic.net/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.22.0/third-party/search/local-search.min.js"></script>







  





</body>
</html>
